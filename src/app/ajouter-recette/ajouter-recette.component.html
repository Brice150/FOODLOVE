<section>
  <div class="title">
    <h1>Ajouter Recette</h1>
  </div>
  <form [formGroup]="recipeForm" class="content">
    <mat-stepper
      [linear]="true"
      #stepper
      background="none"
      orientation="vertical"
    >
      <mat-step [stepControl]="firstFormGroup" [formGroup]="firstFormGroup">
        <ng-template matStepLabel>Recette</ng-template>
        <mat-form-field>
          <mat-label>Nom</mat-label>
          <input matInput formControlName="name" />
          @if (firstFormGroup.get('name')!.invalid) {
          <mat-error>
            @if (firstFormGroup.get('name')!.hasError('required')) {
            <span>Le nom de la recette est obligatoire</span>
            } @if (firstFormGroup.get('name')!.hasError('minlength')) {
            <span>Le nom de la recette est trop court</span>
            } @if (firstFormGroup.get('name')!.hasError('maxlength')) {
            <span>Le nom de la recette est trop long</span>
            }
          </mat-error>
          }
        </mat-form-field>
        <mat-form-field>
          <mat-label>Type</mat-label>
          <mat-select formControlName="type">
            @for (type of RecipeType; track type) {
            <mat-option [value]="type">{{ type }}</mat-option>
            }
          </mat-select>
          @if (firstFormGroup.get('type')!.hasError('required')) {
          <mat-error>
            <span>Le type de recette est obligatoire</span>
          </mat-error>
          }
        </mat-form-field>
        <div class="slide-container">
          <span>Durée (min)</span>
          <mat-slider min="5" max="300" discrete step="5">
            <input matSliderThumb formControlName="duration" />
          </mat-slider>
        </div>
        <div class="image-container">
          <label for="image" class="add" title="Ajouter image">
            <i class="bx bxs-image"></i>
            <span class="text">Ajouter</span>
          </label>
          <input
            #imageInput
            type="file"
            id="image"
            (change)="addPicture($any($event.target).files)"
            name="files"
            accept=".jpg, .jpeg, .png, .webp"
          />
          @if (imagePreview) {
          <img [src]="imagePreview" alt="Aperçu de l'image" />
          }
        </div>
      </mat-step>
      <mat-step
        [stepControl]="secondFormGroup"
        [formGroup]="secondFormGroup"
        [state]="firstFormGroup.valid ? 'number' : 'disabled'"
      >
        <ng-template matStepLabel>Ingrédients</ng-template>
        <mat-form-field>
          <mat-label>Ingrédients</mat-label>
          <input matInput formControlName="ingredients" />
          @if (secondFormGroup.get('ingredients')!.invalid) {
          <mat-error>
            @if (secondFormGroup.get('ingredients')!.hasError('required')) {
            <span>Les ingrédients de la recette sont obligatoires</span>
            }
          </mat-error>
          }
        </mat-form-field>
      </mat-step>
      <mat-step
        [stepControl]="thirdFormGroup"
        [formGroup]="thirdFormGroup"
        [state]="secondFormGroup.valid ? 'number' : 'disabled'"
      >
        <ng-template matStepLabel>Etapes</ng-template>
        <mat-form-field>
          <mat-label>Etapes</mat-label>
          <input matInput formControlName="steps" />
          @if (thirdFormGroup.get('steps')!.invalid) {
          <mat-error>
            @if (thirdFormGroup.get('steps')!.hasError('required')) {
            <span>Les étapes de la recette sont obligatoires</span>
            }
          </mat-error>
          }
        </mat-form-field>
        <div class="button-container">
          <a (click)="addRecipe()" title="Ajouter recette">
            <i class="bx bxs-bowl-rice"></i>
            <span class="text">Ajouter</span>
          </a>
        </div>
      </mat-step>
      <ng-template matStepperIcon="disabled">
        <i class="bx bx-block"></i>
      </ng-template>
    </mat-stepper>
  </form>
</section>
